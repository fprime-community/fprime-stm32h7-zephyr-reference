# ReferenceDeployment Application

This deployment was auto-generated by the F' utility tool.

## Initial project setup
The setup.sh script can be run to build and install all required dependencies for this project
```sh
bash setup.sh
```

Activate the created virtual environment
```sh
# In top level project directory
source fprime-venv/bin/activate
```

### Install the arduino_cli and tools for stm32

```
curl -fsSL https://raw.githubusercontent.com/arduino/arduino-cli/master/install.sh | BINDIR=$VIRTUAL_ENV/bin sh
arduino-cli config init
arduino-cli config add board_manager.additional_urls https://github.com/stm32duino/BoardManagerFiles/raw/main/package_stmicroelectronics_index.json
arduino-cli core install STMicroelectronics:stm32
```

## Building and Running the ReferenceDeployment Application
> [!Note]
> This step can be skipped if the setup.sh script is run. However, any changes made will require you to run `fprime-util build` and may require `fprime-util generate`

In order to build the ReferenceDeployment application, or any other FÂ´ application, we first need to generate a build directory. This can be done with the following commands:

```
cd ReferenceDeployment
fprime-util generate
```

The next step is to build the ReferenceDeployment application's code.
```
fprime-util build
```

## Flashing the NUCLEO H723ZG development board
```sh
sh ~/Library/Arduino15/packages/STMicroelectronics/tools/STM32Tools/2.3.0/stm32CubeProg.sh -i swd -f build-fprime-automatic-zephyr/zephyr/zephyr.hex -c /dev/cu.usbmodem142203 
```

> [!Note]
> `~/Library/Arduino15` may be different. It may be in `~/.arduino15`

> [!Note]
> `/dev/cu.usbmodem142203` will likely need to be replaced with the correct port. This can be found by running the following command: `ls -l /dev/cu.usb*`

> [!Note]
> Two USBs connections are required. USB PWR is used to flash the development board and access the debug terminal, USER USB is used to connect to the f prime GDS

## Running the application and F' GDS

The following command will spin up the F' GDS as well as run the application binary and the components necessary for the GDS and application to communicate.

```sh
fprime-gds -n --dictionary ./build-artifacts/zephyr/fprime-zephyr-deployment/dict/ReferenceDeploymentTopologyDictionary.json --communication-selection uart --uart-device /dev/cu.usbmodem142101 --uart-baud 115200 
```

> [!Note]
> `/dev/cu.usbmodem142203` will likely need to be replaced with the correct port. This can be found by running the following command: `ls -l /dev/cu.usb*`